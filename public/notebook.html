<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Razan</title>
    <link rel="icon" type="image/x-icon" href="/logo-design.png">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script type="module">
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js';
      import { 
        getFirestore, 
        collection, 
        addDoc, 
        getDocs, 
        doc, 
        deleteDoc, 
        updateDoc,
        getDoc,
        orderBy,
        query,
        serverTimestamp
      } from 'https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js';

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyB084-ENowSoOexW2qMDdP5y2fntGqwU4o",
        authDomain: "razanai-677f7.firebaseapp.com",
        projectId: "razanai-677f7",
        storageBucket: "razanai-677f7.firebasestorage.app",
        messagingSenderId: "1013191736728",
        appId: "1:1013191736728:web:fa8424a8026279ad663fed"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Make functions globally available
      window.db = db;
      window.firestoreFunctions = {
        collection,
        addDoc,
        getDocs,
        getDoc,
        doc,
        deleteDoc,
        updateDoc,
        orderBy,
        query,
        serverTimestamp
      };
    </script>
    <style>
        * {
            font-family: "Poppins", sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #f8fafc;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .nav {
            height: 100vh;
            background: white;
            border-right: 1px solid #e2e8f0;
            color: #374151;
            padding: 1rem 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            min-width: 120px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.75rem;
            line-height: 1rem;
            color: #64748b;
            cursor: pointer;
            transition: color 0.2s;
            padding: 0.5rem;
            border-radius: 0.375rem;
        }

        .nav-item:hover {
            color: #374151;
        }

        .nav-item.active {
            background-color: #2563eb;
            color: white;
            font-weight: 500;
        }

        .nav-item i {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .symptom-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 0.75rem;
            transition: box-shadow 0.2s;
            flex: 1;
            min-width: 300px;
            max-width: fit-content;
        }

        .symptom-card:hover {
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background-color: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
        }

        .btn-secondary {
            background-color: white;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn-secondary:hover {
            background-color: #f9fafb;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            outline: none;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .icon-btn {
            cursor: pointer;
            transition: color 0.2s;
            font-size: 1.125rem;
        }

        .icon-btn:hover {
            opacity: 0.8;
        }

        .text-blue { color: #2563eb; }
        .text-red { color: #dc2626; }
        .text-slate { color: #64748b; }
        .text-gray { color: #374151; }
    </style>
</head>
<body>
    <main style="display: flex; width: 100vw; height: 100vh;">
      <nav class="nav">
        <div style="display: flex; flex-direction: column; gap: 1.25rem; align-items: center;">
          <img src="/logo-design.png" alt="logo" style="max-width: 60px;">
          <div class="nav-item" onclick="navigateTo('chatbot.html')">
            <i class="ri-chat-voice-ai-line"></i>
            <span>Chat</span>
          </div>
          <div class="nav-item" onclick="navigateTo('health_news.html')">
            <i class="ri-news-line"></i>
            <span>Discover</span>
          </div>
          <div class="nav-item active">
            <i class="ri-file-list-3-line"></i>
            <span>Notebook</span>
          </div>
        </div>
        <div class="nav-item">
          <i class="ri-account-pin-circle-line"></i>
          <span>Account</span>
        </div>
      </nav>

      <!-- Notebook section -->
      <div style="flex: 1; height: 100%; padding: 2rem; overflow-y: auto; background: white;">
        <div style="width: 100%; max-width: 72rem; margin: 0 auto;" class="fade-in">
          <div style="margin-bottom: 2rem;">
            <h1 style="font-size: 2.25rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">Symptom Notebook</h1>
            <p style="color: #6b7280; font-size: 1.125rem;">Track and monitor your symptoms over time</p>
          </div>

          <!-- Symptoms grid layout -->
          <div style="display: flex; justify-content: space-between; gap: 1rem; flex-wrap: wrap;" id="symptoms-container">
            <!-- Symptom cards will be loaded here dynamically -->
          </div>

          <!-- Add New Symptom Button -->
          <div style="margin-top: 2rem; display: flex; justify-content: center;">
            <button id="add-symptom-btn" class="btn btn-primary">
              <i class="ri-add-line"></i>
              Add New Symptom
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- Add/Edit Symptom Modal -->
    <div id="symptom-modal" class="modal">
      <div class="modal-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
          <h2 id="modal-title" style="font-size: 1.5rem; font-weight: 600; color: #1f2937;">Add New Symptom</h2>
          <button id="close-modal" class="icon-btn text-slate">
            <i class="ri-close-line" style="font-size: 1.5rem;"></i>
          </button>
        </div>
        
        <form id="symptom-form">
          <div class="form-group">
            <label for="symptom-name" class="form-label">Symptom Name</label>
            <input type="text" id="symptom-name" name="name" required class="form-input">
          </div>
          
          <div class="form-group">
            <label for="symptom-description" class="form-label">Description</label>
            <textarea id="symptom-description" name="description" rows="4" required class="form-input"></textarea>
          </div>
          
          <div style="display: flex; gap: 0.75rem; justify-content: flex-end; margin-top: 1.5rem;">
            <button type="button" id="cancel-btn" class="btn btn-secondary">Cancel</button>
            <button type="submit" id="save-btn" class="btn btn-primary">Save Symptom</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      let currentEditingId = null;
      let symptomsData = new Map(); // Store symptoms data locally for easier access

      function navigateTo(page) {
        window.location.href = page;
      }

      // Time formatting for symptoms
      function formatTime(timestamp) {
        if (!timestamp || !timestamp.toDate) return 'Unknown time';
        const date = timestamp.toDate();
        if (isNaN(date.getTime())) return 'Unknown time';
        return date.toLocaleString('en-US', { 
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: 'numeric', 
          minute: '2-digit',
          hour12: true 
        });
      }

      // Load symptoms from Firestore
      async function loadSymptoms() {
        try {
          const symptomsContainer = document.getElementById('symptoms-container');
          const { collection, getDocs, orderBy, query } = window.firestoreFunctions;
          const q = query(collection(window.db, 'symptoms'), orderBy('timestamp', 'desc'));
          const querySnapshot = await getDocs(q);
          
          symptomsContainer.innerHTML = '';
          symptomsData.clear();
          
          querySnapshot.forEach((doc) => {
            const symptom = doc.data();
            symptomsData.set(doc.id, symptom); // Store data locally
            const symptomCard = createSymptomCard(doc.id, symptom);
            symptomsContainer.appendChild(symptomCard);
          });

          if (querySnapshot.empty) {
            symptomsContainer.innerHTML = `
              <div style="text-align: center; padding: 3rem; color: #6b7280; width: 100%;">
                <i class="ri-file-list-3-line" style="font-size: 4rem; margin-bottom: 1rem; display: block;"></i>
                <h3 style="font-size: 1.25rem; margin-bottom: 0.5rem;">No symptoms recorded yet</h3>
                <p>Start tracking your symptoms by adding your first entry.</p>
              </div>
            `;
          }
        } catch (error) {
          console.error('Error loading symptoms:', error);
          alert('Error loading symptoms. Please try again.');
        }
      }

      // Create symptom card element
      function createSymptomCard(id, symptom) {
        const card = document.createElement('div');
        card.className = 'symptom-card';
        
        card.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
            <h3 style="font-size: 1.125rem; font-weight: 600; color: #1f2937;">${symptom.name}</h3>
            <span style="font-size: 0.75rem; color: #64748b; padding: 0.25rem 0.75rem; background: #f1f5f9; border-radius: 9999px;">${formatTime(symptom.timestamp)}</span>
          </div>
          <p style="color: #6b7280; margin-bottom: 1rem; line-height: 1.5;">${symptom.description}</p>
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <div style="display: flex; gap: 0.75rem; align-items: center;">
              <i class="ri-edit-line icon-btn text-blue" onclick="editSymptom('${id}')" title="Edit symptom"></i>
              <i class="ri-delete-bin-line icon-btn text-red" onclick="deleteSymptom('${id}')" title="Delete symptom"></i>
            </div>
          </div>
        `;
        
        return card;
      }

      // Add new symptom
      async function addSymptom(name, description) {
        try {
          const { collection, addDoc, serverTimestamp } = window.firestoreFunctions;
          
          await addDoc(collection(window.db, 'symptoms'), {
            name: name,
            description: description,
            timestamp: serverTimestamp()
          });
          
          loadSymptoms();
        } catch (error) {
          console.error('Error adding symptom:', error);
          alert('Error adding symptom. Please try again.');
        }
      }

      // Edit symptom - Fixed to use local data
      async function editSymptom(id) {
        try {
          const symptom = symptomsData.get(id);
          
          if (symptom) {
            currentEditingId = id;
            document.getElementById('modal-title').textContent = 'Edit Symptom';
            document.getElementById('symptom-name').value = symptom.name;
            document.getElementById('symptom-description').value = symptom.description;
            document.getElementById('save-btn').textContent = 'Update Symptom';
            document.getElementById('symptom-modal').classList.add('show');
          } else {
            // Fallback to Firestore if not found locally
            const { doc, getDoc } = window.firestoreFunctions;
            const docRef = doc(window.db, 'symptoms', id);
            const docSnap = await getDoc(docRef);
            
            if (docSnap.exists()) {
              const symptom = docSnap.data();
              currentEditingId = id;
              document.getElementById('modal-title').textContent = 'Edit Symptom';
              document.getElementById('symptom-name').value = symptom.name;
              document.getElementById('symptom-description').value = symptom.description;
              document.getElementById('save-btn').textContent = 'Update Symptom';
              document.getElementById('symptom-modal').classList.add('show');
            } else {
              alert('Symptom not found');
            }
          }
        } catch (error) {
          console.error('Error loading symptom for edit:', error);
          alert('Error loading symptom. Please try again.');
        }
      }

      // Update symptom
      async function updateSymptom(id, name, description) {
        try {
          const { doc, updateDoc } = window.firestoreFunctions;
          
          await updateDoc(doc(window.db, 'symptoms', id), {
            name: name,
            description: description
          });
          
          loadSymptoms();
        } catch (error) {
          console.error('Error updating symptom:', error);
          alert('Error updating symptom. Please try again.');
        }
      }

      // Delete symptom
      async function deleteSymptom(id) {
        if (!confirm('Are you sure you want to delete this symptom?')) {
          return;
        }
        
        try {
          const { doc, deleteDoc } = window.firestoreFunctions;
          
          await deleteDoc(doc(window.db, 'symptoms', id));
          
          loadSymptoms();
        } catch (error) {
          console.error('Error deleting symptom:', error);
          alert('Error deleting symptom. Please try again.');
        }
      }

      // Modal functionality
      document.getElementById('add-symptom-btn').addEventListener('click', () => {
        currentEditingId = null;
        document.getElementById('modal-title').textContent = 'Add New Symptom';
        document.getElementById('symptom-form').reset();
        document.getElementById('save-btn').textContent = 'Save Symptom';
        document.getElementById('symptom-modal').classList.add('show');
      });

      document.getElementById('close-modal').addEventListener('click', () => {
        document.getElementById('symptom-modal').classList.remove('show');
      });

      document.getElementById('cancel-btn').addEventListener('click', () => {
        document.getElementById('symptom-modal').classList.remove('show');
      });

      // Form submission
      document.getElementById('symptom-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const name = document.getElementById('symptom-name').value.trim();
        const description = document.getElementById('symptom-description').value.trim();
        
        if (!name || !description) {
          alert('Please fill in all fields');
          return;
        }

        const saveBtn = document.getElementById('save-btn');
        const originalText = saveBtn.textContent;
        saveBtn.textContent = 'Saving...';
        saveBtn.disabled = true;
        
        try {
          if (currentEditingId) {
            await updateSymptom(currentEditingId, name, description);
          } else {
            await addSymptom(name, description);
          }
          
          document.getElementById('symptom-modal').classList.remove('show');
          document.getElementById('symptom-form').reset();
        } catch (error) {
          console.error('Error saving symptom:', error);
          alert('Error saving symptom. Please try again.');
        } finally {
          saveBtn.textContent = originalText;
          saveBtn.disabled = false;
        }
      });

      // Close modal when clicking outside
      document.getElementById('symptom-modal').addEventListener('click', (e) => {
        if (e.target.id === 'symptom-modal') {
          document.getElementById('symptom-modal').classList.remove('show');
        }
      });

      // Load symptoms when page loads
      window.addEventListener('load', () => {
        // Add a small delay to ensure Firebase is fully initialized
        setTimeout(() => {
          loadSymptoms();
        }, 100);
      });

      // Make functions global for onclick handlers
      window.editSymptom = editSymptom;
      window.deleteSymptom = deleteSymptom;
    </script>
</body>
</html>